<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }


#todo{

	position: absolute;
	top: 0%;
	left: 0%;
	width: 100%;
	height: 100%;
	background-color: rgb(255, 255, 255);
	z-index: 1;
}

#idlogin{

	position: absolute;top: 30%;
	height: 40%;
	left: 10%;
	width: 80%;
	background-color: rgb(0, 0, 0);

	border: 5px solid #1C6EA4;
border-radius: 40px 39px 40px 40px;
opacity: 0.7;
}
#idlabeluser{

	position: absolute;
	top: 10%;
	left: 5%;
	width: 90%;
	font-size: 13px;
	color: rgb(0, 0, 0);
}

#iduser{

position: absolute;
top: 20%;
left: 5%;
width: 90%;
font-size: 13px;
color: rgb(0, 0, 0);
}


#idlabelpass{

position: absolute;
top: 50%;
left: 5%;
width: 90%;
font-size: 13px;
color: rgb(0, 0, 0);
}
#idpass{

position: absolute;
top: 60%;
left: 5%;
width: 90%;
font-size: 13px;
color: rgb(0, 0, 0);
}

#idbtok{

position: absolute;
top: 85%;
left: 30%;
width: 40%;
height: 30px;
font-size: 13px;
color: rgb(0, 0, 0);

background-color: rgb(255, 255, 255)
}

#idh3{

	position: absolute;
	top: -50%;
	height: 12%;
	font-size: 14px;
	color: #1C6EA4;
	left: 0%;
	width: 100%;
	padding: 2px;
	margin: auto;
	text-align: center;
}


#idh3todo{

position: absolute;
top: 10%;
height: 12%;
font-size: 14px;
color: rgb(255, 255, 255);
left: 0%;
width: 100%;
padding: 2px;
margin: auto;
text-align: center;
}



		</style>
<script src="https://www.gstatic.com/firebasejs/5.9.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBmOO5WzNtKRtWzoo2jalCToYMfc01mkJY",
    authDomain: "sitcar-33718.firebaseapp.com",
    databaseURL: "https://sitcar-33718.firebaseio.com",
    projectId: "sitcar-33718",
    storageBucket: "sitcar-33718.appspot.com",
    messagingSenderId: "531952806781"
  };
  firebase.initializeApp(config);
</script>
	</head>
	<body>

        <div id="todo">
				<h3 id="idh3todo"></h3>
<div id="idlogin">

	<h3 id="idh3">LOGIN</h3>
     <label id="idlabeluser" for="">user:</label>
	<input id="iduser" placeholder="user" type="text">

	<label id="idlabelpass" for="">pass:</label>	
	<input id="idpass" placeholder="pass" type="text">
	<button onclick="fidbtok();" id="idbtok">ok</button>

</div>

        </div>
		<script src=""></script>
		<script>
traedefirmisdatos();
traedefirecarros();
var vuserfire="";
var vpassfire="";
var objfireuser;
var arrayfirecarros=[];
var arrayfiremisdatos=[];

var  numeroalcomunicamre="";
var  emailacomunciarme="";

var bolestoylogeado=false;
function fidbtok(){

	vuserfire=document.getElementById("iduser").value;
	vpassfire=document.getElementById("idpass").value;
console.log(arrayfirecarros.carros);

	for(var i in arrayfirecarros.carros){

if(arrayfirecarros.carros[i].pass==vpassfire&&arrayfirecarros.carros[i].user==vuserfire){
	bolestoylogeado=true;
objfireuser=arrayfirecarros.carros[i];



}

	}

	if(bolestoylogeado){
		document.getElementById("idlogin").style.display="none";
		//escribeh3("Logeado "+ bolestoylogeado);

		traerllamaagpsandroid();

		//mostrarhora()
		ciclodeldiagps()
	}else{
	//	escribeh3("no esta  registrado comunicate al "+ bolestoylogeado);
	
	}
}

function  escribeh3(st){

	document.getElementById("idh3").innerHTML=st+" "+"<br>" + numeroalcomunicamre+" y "+emailacomunciarme;
}


function  escribeh3todo(st){

document.getElementById("idh3todo").innerHTML=st;
}









function traedefirecarros(){


	firebase.database().ref().child("sitcar").once('value', function(snapshot) {
arrayfirecarros=snapshot.val();




});

}
function traedefirmisdatos(){


	firebase.database().ref().child("misdatos").once('value', function(snapshot) {
arrayfiremisdatos=snapshot.val();




emailacomunciarme=arrayfiremisdatos.email;
ingenieromisdatos=arrayfiremisdatos.ingeniero;
numeroalcomunicamre=arrayfiremisdatos.numcelular;



});

}
var retona="";
function llamandroid(id,st1,st2,st3){ 
// enviarsms  "gpsdlng"  "gps" cuantasllamadasgpsvan
	llamandroid(id,st1,st2,st3);
}


function llamagpsandrodi(){
// enviarsms  "gpsdlng"  "gps" cuantasllamadasgpsvan
	llamandroid("gps","st1","st2","st3");
	escribeh3todo(retona);
	
setTimeout(function (){

	llamandroidporlatylng();
	
},7000);
	
}

function llamagpsandrodiciclo(){
// enviarsms  "gpsdlng"  "gps" cuantasllamadasgpsvan
	llamandroid("gps","st1","st2","st3");
	escribeh3todo(retona);
	
setTimeout(function (){

	llamandroidporlatylngciclo();
	
},7000);
	
}





var vmilat="0";
var vmilng="0";
function llamandroidporlatylng(){

	// enviarsms  "gpsdlng"  "gps" cuantasllamadasgpsvan
	llamandroid("gpsdlat","st1","st2","st3");
vmilng=Android.showToast("gpsdlng","st1","st2","st3");
vmilat= Android.showToast("gpsdlat","st1","st2","st3");
	retona=retona+" lat <-> lng "+  Android.showToast("gpsdlng","st1","st2","st3");
	retona=retona+" llamadas al gps  "+  Android.showToast("cuantasllamadasgpsvan","st1","st2","st3");

	traelinks();

	firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("lat").set(vmilat);
	firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("lng").set(vmilng);
	//child(String(vhoy)).child(vhoras+vminut).push({lat:vmilat,lng:vmilng});




	firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("linkmiwe").set(vlinkmweb);
	firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("linkgmap").set(vlinkgoglemap);
	//child(String(vhoy)).child(vhoras+vminut).push({lat:vmilat,lng:vmilng});






	escribeh3todo(vlinkmweb);
}





function llamandroidporlatylngciclo(){

// enviarsms  "gpsdlng"  "gps" cuantasllamadasgpsvan
llamandroid("gpsdlat","st1","st2","st3");
vmilng=Android.showToast("gpsdlng","st1","st2","st3");
vmilat= Android.showToast("gpsdlat","st1","st2","st3");
retona=retona+" lat <-> lng "+  Android.showToast("gpsdlng","st1","st2","st3");
retona=retona+" llamadas al gps  "+  Android.showToast("cuantasllamadasgpsvan","st1","st2","st3");


mostrarhora();

//escribeh3todo(retona);
}





function recibedelandroidgps(){
	escribeh3todo(retona);
}
var historicolatylng;
function traerllamaagpsandroid(){
	

	firebase.database().ref().child("sitcar").child("carros").child(objfireuser.idfire).child("llamaagpsandroid").on('value', function(snapshot) {



		
document.getElementById("todo").style.backgroundColor ="#000000";

llamagpsandrodi();

});




firebase.database().ref().child("sitcar").child("carros").child(objfireuser.idfire).child("celparaenviarsms").on('value', function(snapshot) {


escribeh3todo(snapshot.val());
		
celularaenviarmsn=String(snapshot.val());
llamandroid("celularaenviamsn",celularaenviarmsn,"st2","st3");

});



firebase.database().ref().child("sitcar").child("carros").child(objfireuser.idfire).child("llamadaenviarsmsami").on('value', function(snapshot) {


escribeh3todo(snapshot.val());
		

	llamadallamadaenviarsmsami();

});






firebase.database().ref().child("sitcar").child("carros").child(objfireuser.idfire).child("emailparaenviar").on('value', function(snapshot) {


	emailaenviarmensaje=snapshot.val();
		
	enviaremail();


});







}
var emailaenviarmensaje="";
var celularaenviarmsn=0;
function llamadallamadaenviarsmsami(){

	Android.showToast("enviarsms","st1","st2","st3");



}

function enviaremail(){

	Android.showToast("email","st1","st2","st3");



}
var dd =0;
var mm=0; //hoy es 0!
var yyyy=0;
var vdia="0";
var cadfire;
var fechafire;
var months;
var cuantashistoricossubdiasva=0;
var  vhoy=yyyy+mm+dd;

var vhoras=0;
var vminut=0;

function mostrarhora(){ 
fechafire=new Date();
vdia=fechafire.getDay();

months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
cadfire=fechafire.getHours()+""+fechafire.getMinutes()+""+fechafire.getSeconds(); 

vhoras=String(fechafire.getHours());
vminut=String(fechafire.getMinutes());
//window.status =cadfire;
//console.log(cadfire);

 dd =fechafire.getDate();
 mm = fechafire.getMonth()+1; //hoy es 0!
yyyy = fechafire.getFullYear();

if(dd<10) {
    dd='0'+dd
} 

if(mm<10) {
    mm='0'+mm
} 

//hoy = mm+'/'+dd+'/'+yyyy;

 vhoy=String(yyyy+mm+dd);
escribeh3(vhoy+" ho  "+vhoras+vminut+"  ");
subefirelatylngmes()

//cuantashistoricossubdiasva=cuantashistoricossubdiasva+1;
//setTimeout("mostrarhora()",5000); //3600000

}


//mostrarhora();


function subefirelatylngmes(){
	firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("historicoslatlng").
	child(vhoy).push({lat:vmilat,lng:vmilng,fecha:vhoy+vhoras+vminut});

}


function  ciclodeldiagps(){


	llamagpsandrodiciclo()
	setTimeout("ciclodeldiagps()",5000)
}//3600000


var vlinkmweb="";
var vlinkgoglemap="";

function  traelinks(){

	vlinkmweb=	Android.showToast("linkmiweb","st1","st2","st3");
	vlinkgoglemap=Android.showToast("linkmgogolemap","st1","st2","st3");


//firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("historicoslatlng").
//firebase.database().ref().child("sitcar").child("carros").child(String(objfireuser.idfire)).child("historicoslatlng").

}//360000

			// Our Javascript will go here.
		</script>
	</body>
</html>